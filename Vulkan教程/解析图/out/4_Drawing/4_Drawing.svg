<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="690px" preserveAspectRatio="none" style="width:2046px;height:690px;background:#FFFFFF;" version="1.1" viewBox="0 0 2046 690" width="2046px" zoomAndPan="magnify"><defs><filter height="300%" id="fbdlmuxd11idt" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter><linearGradient id="gbdlmuxd11idt0" x1="0%" x2="100%" y1="0%" y2="100%"><stop offset="0%" stop-color="#000000"/><stop offset="100%" stop-color="#FFFFFF"/></linearGradient></defs><g><!--MD5=[721b745c50ea2817f9fd8215239815a2]
cluster Command_buffers--><polygon fill="#FFFFFF" filter="url(#fbdlmuxd11idt)" points="710,6,844,6,851,31.1201,2029,31.1201,2029,683,710,683,710,6" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="710" x2="851" y1="31.1201" y2="31.1201"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="128" x="714" y="24.0439">Command_buffers</text><!--MD5=[39a237a1e9c919c7a76176edecb18502]
class VkCommandPool--><rect codeLine="36" fill="#FEFECE" filter="url(#fbdlmuxd11idt)" height="48" id="VkCommandPool" style="stroke:#A80036;stroke-width:1.5;" width="129" x="837.5" y="417.5"/><ellipse cx="852.5" cy="433.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M852.1875,439.5 Q850.25,439.5 849.125,438.0703 Q848,436.6406 848,433.6875 Q848,431.1875 849.1875,429.5 Q850.375,427.8125 852.4375,427.8125 Q852.9219,427.8125 853.4219,427.9219 Q853.8281,428.0625 854.0781,428.0625 Q854.2813,428.0625 854.3672,428.0391 Q854.4531,428.0156 855,427.375 L855.7188,431.5781 L854.7344,432.1719 Q854.25,430.625 853.6797,430.0625 Q853.1094,429.5 852.2031,429.5 Q851.0469,429.5 850.3672,430.6797 Q849.6875,431.8594 849.6875,433.6875 Q849.6875,435.6875 850.2656,436.75 Q850.8438,437.8125 852.1406,437.8125 Q853.0625,437.8125 853.7109,437.2422 Q854.3594,436.6719 854.7031,435.2813 L855.7344,435.7969 Q855.3438,437.5469 854.4063,438.5234 Q853.4688,439.5 852.1875,439.5 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="97" x="866.5" y="439.0576">VkCommandPool</text><line style="stroke:#A80036;stroke-width:1.5;" x1="838.5" x2="965.5" y1="449.5" y2="449.5"/><line style="stroke:#A80036;stroke-width:1.5;" x1="838.5" x2="965.5" y1="457.5" y2="457.5"/><path d="M1001.5,405 L1001.5,437.5 L966.7,441.5 L1001.5,445.5 L1001.5,477.8232 A0,0 0 0 0 1001.5,477.8232 L1458.5,477.8232 A0,0 0 0 0 1458.5,477.8232 L1458.5,415 L1448.5,405 L1001.5,405 A0,0 0 0 0 1001.5,405 " fill="#FBFB77" filter="url(#fbdlmuxd11idt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1448.5,405 L1448.5,415 L1458.5,415 L1448.5,405 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="396" x="1007.5" y="424.8979">vkCreateCommandPool(device, &amp;poolInfo, nullptr, &amp;commandPool)。</text><text fill="#FF0000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="60" x="1007.5" y="450.6743">命令池</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="231" x="1067.5" y="452.2124">管理内存，从中分配Command buffers。</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="436" x="1007.5" y="469.9668">有多少个需要使用的队列族，我们就应该创建多少个对应的CommandPool。</text><!--MD5=[7572a989902aaca7952a707f2581774d]
class VkCommandPoolCreateInfo--><rect codeLine="44" fill="#FEFECE" filter="url(#fbdlmuxd11idt)" height="78.0459" id="VkCommandPoolCreateInfo" style="stroke:#A80036;stroke-width:1.5;" width="343" x="726.5" y="563.5"/><ellipse cx="816.75" cy="579.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M816.4375,585.5 Q814.5,585.5 813.375,584.0703 Q812.25,582.6406 812.25,579.6875 Q812.25,577.1875 813.4375,575.5 Q814.625,573.8125 816.6875,573.8125 Q817.1719,573.8125 817.6719,573.9219 Q818.0781,574.0625 818.3281,574.0625 Q818.5313,574.0625 818.6172,574.0391 Q818.7031,574.0156 819.25,573.375 L819.9688,577.5781 L818.9844,578.1719 Q818.5,576.625 817.9297,576.0625 Q817.3594,575.5 816.4531,575.5 Q815.2969,575.5 814.6172,576.6797 Q813.9375,577.8594 813.9375,579.6875 Q813.9375,581.6875 814.5156,582.75 Q815.0938,583.8125 816.3906,583.8125 Q817.3125,583.8125 817.9609,583.2422 Q818.6094,582.6719 818.9531,581.2813 L819.9844,581.7969 Q819.5938,583.5469 818.6563,584.5234 Q817.7188,585.5 816.4375,585.5 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="154" x="837.25" y="585.0576">VkCommandPoolCreateInfo</text><line style="stroke:#A80036;stroke-width:1.5;" x1="727.5" x2="1068.5" y1="595.5" y2="595.5"/><ellipse cx="737.5" cy="606.5" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="27" x="746.5" y="612.106">flags.</text><line style="stroke:#A80036;stroke-width:1.5;" x1="727.5" x2="1068.5" y1="618.5229" y2="618.5229"/><ellipse cx="737.5" cy="629.5229" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="317" x="746.5" y="635.1289">queueFamilyIndex ：queueFamilyIndices.graphicsFamily.value()。</text><path d="M1105,538 L1105,565.6316 L773.5,607.0115 L1105,573.6316 L1105,601.2632 A0,0 0 0 0 1105,601.2632 L2013,601.2632 A0,0 0 0 0 2013,601.2632 L2013,548 L2003,538 L1105,538 A0,0 0 0 0 1105,538 " fill="#FBFB77" filter="url(#fbdlmuxd11idt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2003,538 L2003,548 L2013,548 L2003,538 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="1111" y="557.8979">命令池有两种可能的标志</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30" x="1254" y="557.8979">flags</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="13" x="1284" y="557.8979">：</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="327" x="1127" y="575.6523">1. VK_COMMAND_POOL_CREATE_TRANSIENT_BIT：</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="70" x="1454" y="575.6523">命令缓冲区</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="1524" y="575.6523">经常用</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="42" x="1563" y="575.6523">新命令</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="1605" y="575.6523">重新记录（可能会改变</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="84" x="1735" y="575.6523">内存分配行为</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="1819" y="575.6523">）。</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="433" x="1127" y="593.4067">2. VK_COMMAND_POOL_CREATE_RESET_COMMAND_BUFFER_BIT：</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="70" x="1560" y="593.4067">命令缓冲区</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="1630" y="593.4067">单独被</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="56" x="1669" y="593.4067">重新记录</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="273" x="1725" y="593.4067">，如果没有这个标志，它们就必须一起被重置。</text><path d="M1105,611.2632 L1105,630.0176 L1063.5,630.0344 L1105,638.0176 L1105,656.772 A0,0 0 0 0 1105,656.772 L1500,656.772 A0,0 0 0 0 1500,656.772 L1500,621.2632 L1490,611.2632 L1105,611.2632 A0,0 0 0 0 1105,611.2632 " fill="#FBFB77" filter="url(#fbdlmuxd11idt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1490,611.2632 L1490,621.2632 L1500,621.2632 L1490,611.2632 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="1111" y="631.1611">每个命令池只能分配</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="224" x="1228" y="631.1611">在单一类型队列上提交的命令缓冲区</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="13" x="1452" y="631.1611">。</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="1111" y="648.9155">这里则是只能分配在</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="1228" y="648.9155">Graphics queue</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="1319" y="648.9155">上提交的Command buffers。</text><!--MD5=[7e7aad86a22940a90fa0fc5926c13e46]
class VkCommandBuffer--><rect codeLine="60" fill="#FEFECE" filter="url(#fbdlmuxd11idt)" height="48" id="VkCommandBuffer" style="stroke:#A80036;stroke-width:1.5;" width="136" x="838" y="67.5"/><ellipse cx="853" cy="83.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M852.6875,89.5 Q850.75,89.5 849.625,88.0703 Q848.5,86.6406 848.5,83.6875 Q848.5,81.1875 849.6875,79.5 Q850.875,77.8125 852.9375,77.8125 Q853.4219,77.8125 853.9219,77.9219 Q854.3281,78.0625 854.5781,78.0625 Q854.7813,78.0625 854.8672,78.0391 Q854.9531,78.0156 855.5,77.375 L856.2188,81.5781 L855.2344,82.1719 Q854.75,80.625 854.1797,80.0625 Q853.6094,79.5 852.7031,79.5 Q851.5469,79.5 850.8672,80.6797 Q850.1875,81.8594 850.1875,83.6875 Q850.1875,85.6875 850.7656,86.75 Q851.3438,87.8125 852.6406,87.8125 Q853.5625,87.8125 854.2109,87.2422 Q854.8594,86.6719 855.2031,85.2813 L856.2344,85.7969 Q855.8438,87.5469 854.9063,88.5234 Q853.9688,89.5 852.6875,89.5 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="104" x="867" y="89.0576">VkCommandBuffer</text><line style="stroke:#A80036;stroke-width:1.5;" x1="839" x2="973" y1="99.5" y2="99.5"/><line style="stroke:#A80036;stroke-width:1.5;" x1="839" x2="973" y1="107.5" y2="107.5"/><path d="M1009,44 L1009,87.5 L974.02,91.5 L1009,95.5 L1009,139.0176 A0,0 0 0 0 1009,139.0176 L1457,139.0176 A0,0 0 0 0 1457,139.0176 L1457,54 L1447,44 L1009,44 A0,0 0 0 0 1009,44 " fill="#FBFB77" filter="url(#fbdlmuxd11idt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1447,44 L1447,54 L1457,54 L1447,44 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="1015" y="63.8979">我们必须为交换链中的每个</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="1171" y="63.8979">Image</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="1206" y="63.8979">记录一个</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="70" x="1258" y="63.8979">命令缓冲区</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="13" x="1328" y="63.8979">。</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="383" x="1015" y="81.6523">所以：commandBuffers.size() == swapChainFramebuffers.size()。</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="421" x="1015" y="109.4067">vkAllocateCommandBuffers(device, &amp;allocInfo, commandBuffers.data())。</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="347" x="1015" y="127.1611">同时分配多个命令缓冲区（数量等于交换链中的Image数量）</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1010" x2="1228" y1="89.5088" y2="89.5088"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1010" x2="1228" y1="91.5088" y2="91.5088"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1228" x2="1238" y1="89.0088" y2="89.0088"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1228" x2="1238" y1="91.0088" y2="91.0088"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1238" x2="1456" y1="89.5088" y2="89.5088"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1238" x2="1456" y1="91.5088" y2="91.5088"/><!--MD5=[75ade177eafdab52774bac62ebaab4b5]
class VkCommandBufferAllocateInfo--><rect codeLine="71" fill="#FEFECE" filter="url(#fbdlmuxd11idt)" height="93.0688" id="VkCommandBufferAllocateInfo" style="stroke:#A80036;stroke-width:1.5;" width="343" x="734.5" y="225.5"/><ellipse cx="818.25" cy="241.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M817.9375,247.5 Q816,247.5 814.875,246.0703 Q813.75,244.6406 813.75,241.6875 Q813.75,239.1875 814.9375,237.5 Q816.125,235.8125 818.1875,235.8125 Q818.6719,235.8125 819.1719,235.9219 Q819.5781,236.0625 819.8281,236.0625 Q820.0313,236.0625 820.1172,236.0391 Q820.2031,236.0156 820.75,235.375 L821.4688,239.5781 L820.4844,240.1719 Q820,238.625 819.4297,238.0625 Q818.8594,237.5 817.9531,237.5 Q816.7969,237.5 816.1172,238.6797 Q815.4375,239.8594 815.4375,241.6875 Q815.4375,243.6875 816.0156,244.75 Q816.5938,245.8125 817.8906,245.8125 Q818.8125,245.8125 819.4609,245.2422 Q820.1094,244.6719 820.4531,243.2813 L821.4844,243.7969 Q821.0938,245.5469 820.1563,246.5234 Q819.2188,247.5 817.9375,247.5 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="167" x="838.75" y="247.0576">VkCommandBufferAllocateInfo</text><line style="stroke:#A80036;stroke-width:1.5;" x1="735.5" x2="1076.5" y1="257.5" y2="257.5"/><ellipse cx="745.5" cy="268.5" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="166" x="754.5" y="274.106">commandPool : VkCommandPool。</text><ellipse cx="745.5" cy="283.5229" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="317" x="754.5" y="289.1289">level : 分配的命令缓冲区是主命令缓冲区，还是辅助命令缓冲区。</text><line style="stroke:#A80036;stroke-width:1.5;" x1="735.5" x2="1076.5" y1="295.5459" y2="295.5459"/><ellipse cx="745.5" cy="306.5459" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="239" x="754.5" y="312.1519">commandBufferCount : commandBuffers.size()。</text><path d="M1120.5,225.5 L1120.5,244.2544 L1071.5,284.0344 L1120.5,252.2544 L1120.5,271.0088 A0,0 0 0 0 1120.5,271.0088 L1753.5,271.0088 A0,0 0 0 0 1753.5,271.0088 L1753.5,235.5 L1743.5,225.5 L1120.5,225.5 A0,0 0 0 0 1120.5,225.5 " fill="#FBFB77" filter="url(#fbdlmuxd11idt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1743.5,225.5 L1743.5,235.5 L1753.5,235.5 L1743.5,225.5 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="475" x="1126.5" y="245.3979">1. VK_COMMAND_BUFFER_LEVEL_PRIMARY : 可以提交到队列执行，但不能从</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="1601.5" y="245.3979">其他命令缓冲区</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="1699.5" y="245.3979">调用。</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="459" x="1126.5" y="263.1523">2. VK_COMMAND_BUFFER_LEVEL_SECONDARY : 不能直接提交，但可以被</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="84" x="1585.5" y="263.1523">主命令缓冲区</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="1669.5" y="263.1523">调用。</text><path d="M1120.5,281.0088 L1120.5,290.886 L993.5,307.0574 L1120.5,298.886 L1120.5,308.7632 A0,0 0 0 0 1120.5,308.7632 L1463.5,308.7632 A0,0 0 0 0 1463.5,308.7632 L1463.5,291.0088 L1453.5,281.0088 L1120.5,281.0088 A0,0 0 0 0 1120.5,281.0088 " fill="#FBFB77" filter="url(#fbdlmuxd11idt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1453.5,281.0088 L1453.5,291.0088 L1463.5,291.0088 L1453.5,281.0088 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="322" x="1126.5" y="300.9067">commandBuffers.resize(swapChainFramebuffers.size());</text><!--MD5=[7b4b3482f41ea6abadc328457b86a97b]
class VkImageView--><rect codeLine="2" fill="url(#gbdlmuxd11idt0)" filter="url(#fbdlmuxd11idt)" height="48" id="VkImageView" style="stroke:#A80036;stroke-width:1.5;" width="106" x="44" y="417.5"/><ellipse cx="59" cy="433.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M58.6875,439.5 Q56.75,439.5 55.625,438.0703 Q54.5,436.6406 54.5,433.6875 Q54.5,431.1875 55.6875,429.5 Q56.875,427.8125 58.9375,427.8125 Q59.4219,427.8125 59.9219,427.9219 Q60.3281,428.0625 60.5781,428.0625 Q60.7813,428.0625 60.8672,428.0391 Q60.9531,428.0156 61.5,427.375 L62.2188,431.5781 L61.2344,432.1719 Q60.75,430.625 60.1797,430.0625 Q59.6094,429.5 58.7031,429.5 Q57.5469,429.5 56.8672,430.6797 Q56.1875,431.8594 56.1875,433.6875 Q56.1875,435.6875 56.7656,436.75 Q57.3438,437.8125 58.6406,437.8125 Q59.5625,437.8125 60.2109,437.2422 Q60.8594,436.6719 61.2031,435.2813 L62.2344,435.7969 Q61.8438,437.5469 60.9063,438.5234 Q59.9688,439.5 58.6875,439.5 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="74" x="73" y="439.0576">VkImageView</text><line style="stroke:#A80036;stroke-width:1.5;" x1="45" x2="149" y1="449.5" y2="449.5"/><line style="stroke:#A80036;stroke-width:1.5;" x1="45" x2="149" y1="457.5" y2="457.5"/><path d="M185.5,427.5 L185.5,437.5 L150.21,441.5 L185.5,445.5 L185.5,455.2544 A0,0 0 0 0 185.5,455.2544 L564.5,455.2544 A0,0 0 0 0 564.5,455.2544 L564.5,437.5 L554.5,427.5 L185.5,427.5 A0,0 0 0 0 185.5,427.5 " fill="#FBFB77" filter="url(#fbdlmuxd11idt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M554.5,427.5 L554.5,437.5 L564.5,437.5 L554.5,427.5 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="358" x="191.5" y="447.3979">swapChainFramebuffers.resize(swapChainImageViews.size());</text><!--MD5=[def9299a06425dc4e31dbe9529d58f53]
class VkFramebufferCreateInfo--><rect codeLine="9" fill="#FEFECE" filter="url(#fbdlmuxd11idt)" height="138.1377" id="VkFramebufferCreateInfo" style="stroke:#A80036;stroke-width:1.5;" width="180" x="7" y="203"/><ellipse cx="26.95" cy="219" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M26.6375,225 Q24.7,225 23.575,223.5703 Q22.45,222.1406 22.45,219.1875 Q22.45,216.6875 23.6375,215 Q24.825,213.3125 26.8875,213.3125 Q27.3719,213.3125 27.8719,213.4219 Q28.2781,213.5625 28.5281,213.5625 Q28.7313,213.5625 28.8172,213.5391 Q28.9031,213.5156 29.45,212.875 L30.1688,217.0781 L29.1844,217.6719 Q28.7,216.125 28.1297,215.5625 Q27.5594,215 26.6531,215 Q25.4969,215 24.8172,216.1797 Q24.1375,217.3594 24.1375,219.1875 Q24.1375,221.1875 24.7156,222.25 Q25.2938,223.3125 26.5906,223.3125 Q27.5125,223.3125 28.1609,222.7422 Q28.8094,222.1719 29.1531,220.7813 L30.1844,221.2969 Q29.7938,223.0469 28.8563,224.0234 Q27.9188,225 26.6375,225 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="137" x="42.05" y="224.5576">VkFramebufferCreateInfo</text><line style="stroke:#A80036;stroke-width:1.5;" x1="8" x2="186" y1="235" y2="235"/><ellipse cx="18" cy="246" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="148" x="27" y="251.606">renderPass : VkRenderPass。</text><ellipse cx="18" cy="261.0229" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="92" x="27" y="266.6289">attachmentCount。</text><ellipse cx="18" cy="276.0459" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="154" x="27" y="281.6519">pAttachments : VkImageView。</text><ellipse cx="18" cy="291.0688" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="30" x="27" y="296.6748">width.</text><ellipse cx="18" cy="306.0918" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="32" x="27" y="311.6978">height.</text><ellipse cx="18" cy="321.1147" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="33" x="27" y="326.7207">layers.</text><line style="stroke:#A80036;stroke-width:1.5;" x1="8" x2="186" y1="333.1377" y2="333.1377"/><path d="M230,253 L230,262.8772 L181,276.5574 L230,270.8772 L230,280.7544 A0,0 0 0 0 230,280.7544 L638,280.7544 A0,0 0 0 0 638,280.7544 L638,263 L628,253 L230,253 A0,0 0 0 0 230,253 " fill="#FBFB77" filter="url(#fbdlmuxd11idt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M628,253 L628,263 L638,263 L628,253 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="236" y="272.8979">应该绑定到renderPass的</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="380" y="272.8979">pAttachmentDescription数组</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="545" y="272.8979">中的元素上。</text><!--MD5=[802563d75e2c98844a8647c69ee51534]
class VkFramebuffer--><rect codeLine="21" fill="#FEFECE" filter="url(#fbdlmuxd11idt)" height="48" id="VkFramebuffer" style="stroke:#A80036;stroke-width:1.5;" width="112" x="41" y="67.5"/><ellipse cx="56" cy="83.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M55.6875,89.5 Q53.75,89.5 52.625,88.0703 Q51.5,86.6406 51.5,83.6875 Q51.5,81.1875 52.6875,79.5 Q53.875,77.8125 55.9375,77.8125 Q56.4219,77.8125 56.9219,77.9219 Q57.3281,78.0625 57.5781,78.0625 Q57.7813,78.0625 57.8672,78.0391 Q57.9531,78.0156 58.5,77.375 L59.2188,81.5781 L58.2344,82.1719 Q57.75,80.625 57.1797,80.0625 Q56.6094,79.5 55.7031,79.5 Q54.5469,79.5 53.8672,80.6797 Q53.1875,81.8594 53.1875,83.6875 Q53.1875,85.6875 53.7656,86.75 Q54.3438,87.8125 55.6406,87.8125 Q56.5625,87.8125 57.2109,87.2422 Q57.8594,86.6719 58.2031,85.2813 L59.2344,85.7969 Q58.8438,87.5469 57.9063,88.5234 Q56.9688,89.5 55.6875,89.5 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="80" x="70" y="89.0576">VkFramebuffer</text><line style="stroke:#A80036;stroke-width:1.5;" x1="42" x2="152" y1="99.5" y2="99.5"/><line style="stroke:#A80036;stroke-width:1.5;" x1="42" x2="152" y1="107.5" y2="107.5"/><path d="M188.5,46 L188.5,87.5 L153.1,91.5 L188.5,95.5 L188.5,137.2632 A0,0 0 0 0 188.5,137.2632 L693.5,137.2632 A0,0 0 0 0 693.5,137.2632 L693.5,56 L683.5,46 L188.5,46 A0,0 0 0 0 188.5,46 " fill="#FBFB77" filter="url(#fbdlmuxd11idt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M683.5,46 L683.5,56 L693.5,56 L683.5,46 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="484" x="194.5" y="65.8979">vkCreateFramebuffer(device, &amp;framebufferInfo, nullptr, &amp;swapChainFramebuffers[i])。</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="194.5" y="93.6523">必须为交换链中的所有</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="324.5" y="93.6523">VkImage</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="375.5" y="93.6523">都创建一个帧缓冲区</text><line style="stroke:#A80036;stroke-width:1.0;" x1="189.5" x2="436" y1="73.7544" y2="73.7544"/><line style="stroke:#A80036;stroke-width:1.0;" x1="189.5" x2="436" y1="75.7544" y2="75.7544"/><line style="stroke:#A80036;stroke-width:1.0;" x1="436" x2="446" y1="73.2544" y2="73.2544"/><line style="stroke:#A80036;stroke-width:1.0;" x1="436" x2="446" y1="75.2544" y2="75.2544"/><line style="stroke:#A80036;stroke-width:1.0;" x1="446" x2="692.5" y1="73.7544" y2="73.7544"/><line style="stroke:#A80036;stroke-width:1.0;" x1="446" x2="692.5" y1="75.7544" y2="75.7544"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="194.5" y="125.4067">frameBuffer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="259.5" y="125.4067">应该和</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="298.5" y="125.4067">RenderPass</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="299" x="369.5" y="125.4067">兼容，这大致意味着：使用相同数量和类型的附件。</text><line style="stroke:#A80036;stroke-width:1.0;" x1="189.5" x2="436" y1="105.5088" y2="105.5088"/><line style="stroke:#A80036;stroke-width:1.0;" x1="189.5" x2="436" y1="107.5088" y2="107.5088"/><line style="stroke:#A80036;stroke-width:1.0;" x1="436" x2="446" y1="105.0088" y2="105.0088"/><line style="stroke:#A80036;stroke-width:1.0;" x1="436" x2="446" y1="107.0088" y2="107.0088"/><line style="stroke:#A80036;stroke-width:1.0;" x1="446" x2="692.5" y1="105.5088" y2="105.5088"/><line style="stroke:#A80036;stroke-width:1.0;" x1="446" x2="692.5" y1="107.5088" y2="107.5088"/><!--MD5=[74a31cf21b97e1d3a448c5f4c4e64e03]
link VkFramebufferCreateInfo to VkFramebufferCreateInfo$$$RIGHT--><!--MD5=[b7d1ce45abd40ae7d20d8cb68aee1739]
link VkFramebuffer to VkFramebufferCreateInfo--><path codeLine="32" d="M97,115.84 C97,135.67 97,165.33 97,193.42 " fill="none" id="VkFramebuffer-to-VkFramebufferCreateInfo" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="97,198.64,101,189.64,97,193.64,93,189.64,97,198.64" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[75ef9a49aece5449db182ef62a9171c2]
link VkFramebufferCreateInfo to VkImageView--><path codeLine="33" d="M188,277 C218.23,277 198.36,316.99 187,345 C175.84,372.51 152.73,396.76 132.71,413.94 " fill="none" id="VkFramebufferCreateInfo-to-VkImageView" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="128.76,417.28,138.2138,414.5185,132.5764,414.0496,133.0452,408.4123,128.76,417.28" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[11e4e13a3b9b0f44aeba999724dab1ba]
link VkCommandPoolCreateInfo to VkCommandPoolCreateInfo$$$RIGHT--><!--MD5=[ec8d5d46c7e4b044f61ae310cbd1c2bb]
link VkCommandPool to VkCommandPoolCreateInfo--><path codeLine="58" d="M901.42,465.62 C900.81,489.8 899.84,528.32 899.09,558.18 " fill="none" id="VkCommandPool-to-VkCommandPoolCreateInfo" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="898.96,563.27,903.19,554.3758,899.0885,558.2717,895.1927,554.1702,898.96,563.27" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[d47171c4a954313b26eb98891df4453b]
link VkCommandBufferAllocateInfo to VkCommandBufferAllocateInfo$$$RIGHT--><!--MD5=[7d8bb8126a09ae1f1cb7f29d1fd5c3e2]
link VkCommandBuffer to VkCommandBufferAllocateInfo--><path codeLine="84" d="M906,115.84 C906,141.13 906,182.39 906,216 " fill="none" id="VkCommandBuffer-to-VkCommandBufferAllocateInfo" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="906,221.33,910,212.33,906,216.33,902,212.33,906,221.33" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[2a5f8c05f561eb7cf58ccb82172a989a]
link VkCommandBufferAllocateInfo to VkCommandPool--><path codeLine="85" d="M734,269 C710.22,269 723.87,301.48 735,322.5 C757.6,365.15 803.3,395.79 841.19,415.14 " fill="none" id="VkCommandBufferAllocateInfo-to-VkCommandPool" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="845.77,417.44,839.5187,409.8294,841.3007,415.1982,835.9319,416.9802,845.77,417.44" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[84f9a7826fea627a46a01d12dbdf6763]
@startuml

class VkImageView #Black/White{

}
note right of VkImageView
    swapChainFramebuffers.resize(swapChainImageViews.size());
end note

class VkFramebufferCreateInfo{
    +renderPass : VkRenderPass。
    +attachmentCount。
    +pAttachments : VkImageView。
    +width.
    +height.
    +layers.
}
note right of VkFramebufferCreateInfo::pAttachments
    应该绑定到renderPass的<color:#Red>pAttachmentDescription数组</color>中的元素上。
end note

class VkFramebuffer{

}
note right of VkFramebuffer
    vkCreateFramebuffer(device, &framebufferInfo, nullptr, &swapChainFramebuffers[i])。
    ==================
    必须为交换链中的所有<color:#Red>VkImage</color>都创建一个帧缓冲区
    ==================
    <color:#Red>frameBuffer</color>应该和<color:#Red>RenderPass</color>兼容，这大致意味着：使用相同数量和类型的附件。
end note

VkFramebuffer - -> VkFramebufferCreateInfo
VkFramebufferCreateInfo::pAttachments - -> VkImageView

package Command_buffers {
    class VkCommandPool{
    }
    note right of VkCommandPool
        vkCreateCommandPool(device, &poolInfo, nullptr, &commandPool)。
        <size:20><color:#Red>命令池</color></size>管理内存，从中分配Command buffers。
        有多少个需要使用的队列族，我们就应该创建多少个对应的CommandPool。
    end note    

    class VkCommandPoolCreateInfo{
        +queueFamilyIndex ：queueFamilyIndices.graphicsFamily.value()。
        +flags.
    }
    note right of VkCommandPoolCreateInfo::flags
        命令池有两种可能的标志**flags**：
            1. VK_COMMAND_POOL_CREATE_TRANSIENT_BIT：**命令缓冲区**经常用**新命令**重新记录（可能会改变**内存分配行为**）。
            2. VK_COMMAND_POOL_CREATE_RESET_COMMAND_BUFFER_BIT：**命令缓冲区**单独被**重新记录**，如果没有这个标志，它们就必须一起被重置。
    end note
    note right of VkCommandPoolCreateInfo::queueFamilyIndex
        每个命令池只能分配**在单一类型队列上提交的命令缓冲区**。
        这里则是只能分配在<color:#Red>Graphics queue</color>上提交的Command buffers。
    end note

    VkCommandPool - -> VkCommandPoolCreateInfo

    class VkCommandBuffer{

    }
    note right of VkCommandBuffer
        我们必须为交换链中的每个<color:#Red>Image</color>记录一个**命令缓冲区**。
        所以：commandBuffers.size() == swapChainFramebuffers.size()。
        ==============
        vkAllocateCommandBuffers(device, &allocInfo, commandBuffers.data())。
        同时分配多个命令缓冲区（数量等于交换链中的Image数量）
    end note

    class VkCommandBufferAllocateInfo{
        +commandPool : VkCommandPool。
        +level : 分配的命令缓冲区是主命令缓冲区，还是辅助命令缓冲区。
        +commandBufferCount : commandBuffers.size()。
    }
    note right of VkCommandBufferAllocateInfo::level
        1. VK_COMMAND_BUFFER_LEVEL_PRIMARY : 可以提交到队列执行，但不能从**其他命令缓冲区**调用。
        2. VK_COMMAND_BUFFER_LEVEL_SECONDARY : 不能直接提交，但可以被**主命令缓冲区**调用。
    end note
    note right of VkCommandBufferAllocateInfo::commandBufferCount
        commandBuffers.resize(swapChainFramebuffers.size());
    end note

    VkCommandBuffer - -> VkCommandBufferAllocateInfo
    VkCommandBufferAllocateInfo::commandPool - -> VkCommandPool

}

@enduml

PlantUML version 1.2022.0(Wed Jan 12 00:16:42 CST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: GBK
Language: zh
Country: CN
--></g></svg>