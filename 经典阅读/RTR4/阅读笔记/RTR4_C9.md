# Chapter 9——Physically Based Shading

## 1.  Physics of Light

==光和物质的相互作用形成了PBS的基础==。为了理解这些相互作用，对光的本质有一个基本的理解是有帮助的。在物理光学中，光被建模为电磁横波`transverse wave`——一种使电场和磁场垂直于其传播方向的波。这两个场的振荡是耦合的（ coupled）。磁场和电场矢量相互垂直，它们的长度之比是固定的（这个比值等于相速度` phase velocity`，==通常称其为光速c==）

下图是一个最简单的光波——一个完美的Sin曲线。这种波只有一个波长，用$\lambda$表示。单波长的光叫做单色光`monochromatic light`。然而，实际中遇到的大多数光波是多色的，包含许多不同的波长。在另一方面，单色光也是非常简单——它是`linearly polarized`的（偏振的）。这意味着，在空间的一个固定点上，电场和磁场都沿着一条线来回移动。相反，在这本书中，我们关注的是==更普遍的非偏振光==——在非偏振光中，场振荡` the field oscillations`均匀地分布在所有方向（垂直于传播轴的）上。尽管它们很简单，但==理解单色线性偏振波的行为是有用的，因为任何光波都可以分解成这些波的组合==。

<img src="RTR4_C9.assets/image-20201026132200500.png" alt="image-20201026132200500" style="zoom:80%;" />

波长`wavelength`通常多大呢？可以拿蜘蛛丝和头发来对比：

<img src="RTR4_C9.assets/image-20201026133655439.png" alt="image-20201026133655439" style="zoom:67%;" />

光波携带能量，能量流的密度等于电场和磁场的乘积，由于磁场和电场成比例，所以也就是与电场的平方成比例。==我们关注电场==，因为它对物质的影响比磁场强得多。==在渲染中，我们关注的是随时间的变化的平均能量流，这与波振幅的平方成比例==。==这个平均能量流的密度就是辐照度E==。==光波线性结合==——总波是各分量波的和。然而，由于辐照度与振幅的平方成比例，这似乎会导致一个==悖论==。两个相等的波相加，不会导致“1 + 1 = 4”的情况吗？既然辐照度E度量的是能量流，这不会破坏能量守恒吗？这两个问题的答案是：分别是==“有时”和“不”==。

为了说明，举一个简单的例子：n个单色波的加法，除了相位相同之外。每n波的振幅为a。如前所述，每一波的辐照度E~1~与$a^2$成正比，换句话说：$E_1 = ka^2$。见下图，n个单色波相加的三种情况，左边的情况是`constructive interference`，中间是`destructive interference`。这两个都是`coherent addition`（相干叠加）的特殊情况，所以第一个问题的答案是"有时"。

![image-20201026135308585](RTR4_C9.assets/image-20201026135308585.png)

但大多数情况（上图右），波的叠加是不相干的`incoherent`，在这种情况下，组合波的振幅是√n，每个波的辐照度加起来，线性地等于初始辐照度的n倍。但只按照上图左、中，似乎不满足能量守恒，但是上诉知识空间某个位置的情况，随着位置移动，相位会发生变化，如下图：（这并不违反能量守恒定律，因为通过相长干涉获得的能量和通过相长干涉损失的能量总是可以抵消掉）

![image-20201026140547601](RTR4_C9.assets/image-20201026140547601.png)

光离开光源后，在空间中遨游，直到遇到和其交互的物质。==光-物交互的核心理论是简单的==：振荡的电场对物质中的电荷进行推拉，使它们依次振荡；振荡的电荷发射出新的光波，使入射光波的部分能量定向到新的方向。==这也就是各种渲染理论的基础——散射==`scattering`。

散射的光波与原波的频率相同。通常情况下，当原波包含多个频率的光波时，每个频率的光波都会分别与物质发生作用（也只会对相同频率的出射光产生影响），除了荧光和磷光，我们在本书中不会介绍。

在渲染中，我们关注的是分子的集合。集合体的相互作用与孤立分子的相互作用不一样。从附近的分子散射出来的波通常是相干的，因此表现出干扰，因为它们来源于同一个入射波。The rest of this section is devoted to several important special cases of light scattering from multiple molecules。



### 1.1 Particles

==在理想的气体中，分子通常不会相互影响==，它们的相关位置是完全随机和无关的。在这种情况下，不同分子散射的波之间的相位差是随机的，并且不断变化。因此，它们的能量线性增加，如图9.3的右部。相反，如果分子紧密地挤在比光的波长小得多的团簇中，散射光的波长是同相位的，此时，能量平方增加，如图9.3的左部。

这个解释了为什么云和雾如此强烈地散射光线。它们都是由凝结产生的——空气中的水分子聚集成越来越大的团簇，这大大增加了光的散射。

当讨论光散射时，粒子`particles`用于指孤立的分子和多分子团簇。由于来自多分子聚簇（直径小于波长）的散射是来自孤立分子的散射的放大，它表现出相同的方向变化和波长依赖性。这种类型的散射在大气粒子中称为`Rayleigh scattering`，在固体颗粒中称为`Tyndall scattering`。当粒子越来越大，散射光的波长依赖性越来越低，这种类型的散射称为`Mie scattering`。



### 1.2 Media

另一个重要的情况是==光通过均匀介质传播==，均匀介质包括：晶体，不含杂质、无缝隙的液体和其它固体。在均质介质中，散射波在除原传播方向外的所有方向上都发生破坏性干扰`interfere destructively`。原始波与各个分子散射的波结合后。除了相位速度和（在某些情况下）振幅之外，==最终结果与原始波相同，不表现出任何散射效应==。

